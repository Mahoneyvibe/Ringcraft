# Story 11.1: PWA Shell & Navigation

## Status
Done

## Story
**As a** club official,
**I want** a mobile-first progressive web app,
**So that** I can access FirstBell on any device.

## Acceptance Criteria
1. PWA is installable on mobile devices (manifest.json, service worker)
2. Bottom navigation displays three tabs: Inbox, Club, Browse
3. Offline-read tolerant (basic service worker caching for app shell)
4. Responsive design: mobile-first with desktop adaptation
5. AI Bar placeholder is visible at top of all screens (non-functional in this story)
6. Firebase Authentication integration allows login/logout
7. Authenticated users see main app shell; unauthenticated users see login screen

## Tasks / Subtasks

- [x] Task 1: Initialize frontend project (AC: 1, 4)
  - [x] 1.1 Create React project with Vite in `/web` directory
  - [x] 1.2 Configure TypeScript with strict mode
  - [x] 1.3 Install and configure Tailwind CSS
  - [x] 1.4 Install Shadcn/ui and initialize with project theme
  - [x] 1.5 Install Lucide React icons
  - [x] 1.6 Configure path aliases (`@/` for `src/`)
  - [x] 1.7 Add `web` script commands to root package.json or create web/package.json
  - [x] 1.8 Update `.idx/dev.nix` to enable Node.js and web preview

- [x] Task 2: Configure PWA (AC: 1, 3)
  - [x] 2.1 Install vite-plugin-pwa
  - [x] 2.2 Create `public/manifest.json` with app name, icons, theme colors
  - [x] 2.3 Generate PWA icons using pwa-asset-generator or create simple placeholder icons (solid #1E3A5F background with "FB" text in white, 192x192 and 512x512 PNG)
  - [x] 2.4 Configure service worker for app shell caching (precache strategy)
  - [x] 2.5 Add meta tags for PWA (theme-color, apple-touch-icon, etc.)
  - [x] 2.6 Create `src/hooks/usePWAInstall.ts` to capture and defer `beforeinstallprompt` event
  - [x] 2.7 Create `src/components/ui/InstallPrompt.tsx` for custom install banner
  - [x] 2.8 Show install prompt after first successful login (not on first visit)
  - [x] 2.9 Store `hasPromptedInstall` in localStorage to avoid re-prompting
  - [x] 2.10 Test PWA installability in Chrome DevTools â†’ Application â†’ Manifest

- [x] Task 3: Set up Firebase client SDK (AC: 6, 7)
  - [x] 3.1 Install firebase client SDK (`firebase`)
  - [x] 3.2 Create `src/lib/firebase.ts` with Firebase config
  - [x] 3.3 Create `src/contexts/AuthContext.tsx` with auth state management
  - [x] 3.4 Implement `useAuth` hook returning user, loading, signIn, signOut
  - [x] 3.5 Configure Firebase Auth emulator connection for development
  - [x] 3.6 Create environment variables for Firebase config (`.env.local`)

- [x] Task 4: Implement app shell layout (AC: 2, 4, 5)
  - [x] 4.1 Create `src/components/layout/AppShell.tsx` (main layout wrapper)
  - [x] 4.2 Create `src/components/layout/AIBar.tsx` (placeholder, non-functional)
  - [x] 4.3 Create `src/components/layout/BottomNav.tsx` (mobile: 3 tabs)
  - [x] 4.4 Create `src/components/layout/SideNav.tsx` (desktop: sidebar)
  - [x] 4.5 Implement responsive breakpoint switching (bottom nav < 1024px, side nav >= 1024px)
  - [x] 4.6 Apply design system colors from front-end-spec.md Â§6.2
  - [x] 4.7 Apply typography scale from front-end-spec.md Â§6.3

- [x] Task 5: Implement routing (AC: 2)
  - [x] 5.1 Install React Router (`react-router-dom`)
  - [x] 5.2 Create `src/pages/InboxPage.tsx` (placeholder: centered "Inbox" heading + "Coming in Story 11.4" subtext)
  - [x] 5.3 Create `src/pages/ClubPage.tsx` (placeholder: centered "My Club" heading + "Coming soon" subtext)
  - [x] 5.4 Create `src/pages/BrowsePage.tsx` (placeholder: centered "Browse" heading + "Coming soon" subtext)
  - [x] 5.5 Create `src/pages/LoginPage.tsx` with Firebase Auth UI
  - [x] 5.6 Create `src/components/auth/ProtectedRoute.tsx` wrapper
  - [x] 5.7 Configure routes in `src/App.tsx`
  - [x] 5.8 Create `src/components/ui/LoadingSpinner.tsx` for auth loading state

- [x] Task 6: Implement authentication flow (AC: 6, 7)
  - [x] 6.1 Create login page with email/password form
  - [x] 6.2 Add Google sign-in button (optional, if configured)
  - [x] 6.3 Implement sign-out functionality in user menu
  - [x] 6.4 Redirect unauthenticated users to login
  - [x] 6.5 Redirect authenticated users from login to Inbox
  - [x] 6.6 Show loading state while auth initializes
  - [x] 6.7 Display inline error messages for failed login (invalid credentials, user not found)
  - [x] 6.8 Handle network errors with "Unable to connect. Check your connection and try again."
  - [x] 6.9 Clear error messages when user starts typing again

- [x] Task 7: Configure Firebase Hosting build (AC: 1)
  - [x] 7.1 Update `firebase.json` hosting.public to point to `web/dist`
  - [x] 7.2 Add build script: `npm run build` outputs to `web/dist`
  - [x] 7.3 Configure Vite base path for Firebase Hosting
  - [x] 7.4 Test local build and preview with `firebase serve`

- [x] Task 8: Write component tests (AC: 1, 2, 4, 5, 6, 7)
  - [x] 8.1 Install Vitest and React Testing Library
  - [x] 8.2 Create `src/__tests__/components/BottomNav.test.tsx`
  - [x] 8.3 Create `src/__tests__/components/AppShell.test.tsx`
  - [x] 8.4 Create `src/__tests__/components/ProtectedRoute.test.tsx`
  - [x] 8.5 Create `src/__tests__/contexts/AuthContext.test.tsx`
  - [x] 8.6 Create `src/__tests__/pages/LoginPage.test.tsx`
  - [x] 8.7 Create `src/__tests__/hooks/usePWAInstall.test.tsx`
  - [x] 8.8 Test: Bottom nav renders 3 tabs (Inbox, Club, Browse)
  - [x] 8.9 Test: Navigation highlights active tab
  - [x] 8.10 Test: AI Bar placeholder renders at top with disabled mic icon
  - [x] 8.11 Test: ProtectedRoute redirects unauthenticated users
  - [x] 8.12 Test: ProtectedRoute allows authenticated users
  - [x] 8.13 Test: Auth context provides user state
  - [x] 8.14 Test: Responsive layout switches at breakpoint
  - [x] 8.15 Test: Login form displays error on invalid credentials
  - [x] 8.16 Test: Login form displays network error message
  - [x] 8.17 Test: Error message clears when user types
  - [x] 8.18 Test: PWA install prompt shows after successful login
  - [x] 8.19 Test: PWA install prompt not shown if already prompted (localStorage)
  - [x] 8.20 Test: App shell displays offline banner when network unavailable

## Dev Notes

### Architecture Context
[Source: Architecture v1 Â§2.1 Client]

**Client Requirements:**
- Progressive Web App (PWA)
- Mobile-first, touch-optimised
- AI-first interface (AI bar placeholder in this story, functional in Story 11.2)
- Offline-read tolerant (cached rosters, shows, proposals)
- Deep-link landing pages for no-login proposal responses (future story)

**Firebase Services Used:**
- Firebase Auth â€” user identity
- Firebase Hosting â€” app + deep-link routes

### Design System
[Source: front-end-spec.md Â§5, Â§6]

**Component Library:** Shadcn/ui (headless, customizable)

**Color Palette:**
```css
--primary: #1E3A5F        /* Navigation, headers, primary buttons */
--primary-light: #2E5A8F  /* Hover states, active elements */
--secondary: #F5F5F5      /* Backgrounds, card surfaces */
--accent: #3B82F6         /* Links, AI elements, interactive highlights */
--success: #22C55E        /* Positive feedback, accepted, compliant */
--warning: #F59E0B        /* Cautions, pending states, advisory */
--error: #EF4444          /* Errors, declined, non-compliant */
--neutral-900: #111827    /* Primary text */
--neutral-600: #4B5563    /* Secondary text */
--neutral-300: #D1D5DB    /* Borders, dividers */
--neutral-100: #F3F4F6    /* Subtle backgrounds */
```

**Typography:**
- Primary font: Inter (or system-ui fallback)
- Body: 16px / 1rem, weight 400
- H1: 28px / 1.75rem, weight 700
- H2: 24px / 1.5rem, weight 600
- H3: 20px / 1.25rem, weight 600

**Icons:** Lucide Icons (outline style, 24px default)

### Layout Architecture
[Source: front-end-spec.md Â§2.1]

**Mobile Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI Bar [Ask anything...]    â”‚  â† Persistent top bar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚       Main Content Area         â”‚  â† Scrollable content
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¥ Inbox  â”‚ ğŸ  Club â”‚ ğŸ” Browse â”‚  â† Bottom nav
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Desktop Layout (â‰¥1024px):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI Bar [Ask anything...]              [User Menu]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Inbox   â”‚                                             â”‚
â”‚  Club    â”‚          Main Content Area                  â”‚
â”‚  Browse  â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Breakpoints:**
| Breakpoint | Min Width | Layout |
|------------|-----------|--------|
| Mobile | 320px | Bottom nav, single column |
| Tablet | 768px | Bottom nav, wider cards |
| Desktop | 1024px | Side nav, multi-column capable |

### Navigation Icons
[Source: front-end-spec.md Â§6.4]

| Tab | Icon | Lucide Name |
|-----|------|-------------|
| Inbox | Mail/Bell | `inbox` or `bell` |
| Club | Home | `home` |
| Browse | Search | `search` |

### AI Bar Placeholder (Non-Functional in this Story)
[Required for AC: 5]

The AI Bar in this story is a **visual placeholder only** â€” full functionality comes in Story 11.2.

**Appearance:**
- Fixed position at top of screen
- Height: 56px
- Background: white with subtle bottom border (`--neutral-300`)
- Contains: Robot icon (Lucide `bot`), input field with placeholder "Ask anything...", mic icon (Lucide `mic`), send button (Lucide `send`)
- All elements styled but disabled (opacity 0.6)

**Behavior:**
- Clicking input shows toast: "AI assistant coming in the next update"
- Clicking mic shows toast: "Voice input coming soon"
- Input field is read-only, cannot accept text
- No actual input handling in this story

**Why placeholder?** This story establishes the shell layout. Story 11.2 (immediately following) adds full AI Bar functionality connecting to the `findMatch` backend. Story 11.3 adds voice input.

### PWA Configuration
[Source: front-end-spec.md Â§8.3]

**Manifest Requirements:**
- name: "FirstBell"
- short_name: "FirstBell"
- start_url: "/"
- display: "standalone"
- theme_color: "#1E3A5F"
- background_color: "#FFFFFF"
- icons: 192x192, 512x512 (PNG)

**Service Worker Strategy:**
- Precache app shell (HTML, CSS, JS, fonts)
- Network-first for API calls
- Cache-first for static assets

**Install Prompt Timing:**
- Do NOT show install prompt on first visit
- Capture `beforeinstallprompt` event and defer
- Show custom install prompt after user completes first successful action (e.g., login, view roster)
- Store `hasPromptedInstall` in localStorage to avoid re-prompting
- Provide manual "Add to Home Screen" option in settings/menu

### Firebase Configuration
[Source: firebase.json]

**Hosting Config (already exists):**
- Public directory: needs update to `web/dist`
- SPA rewrite: `**` â†’ `/index.html`
- Emulators: Auth (9099), Hosting (5000)

**Auth Provider:**
- Email/password (primary)
- Google sign-in (optional)

### Authentication Error Handling
[Required for AC: 6, 7]

**Firebase Auth Error Codes to Handle:**
| Error Code | User Message |
|------------|--------------|
| `auth/invalid-credential` | "Invalid email or password. Please try again." |
| `auth/user-not-found` | "No account found with this email." |
| `auth/wrong-password` | "Invalid email or password. Please try again." |
| `auth/too-many-requests` | "Too many failed attempts. Please try again later." |
| `auth/network-request-failed` | "Unable to connect. Check your connection and try again." |
| Default/unknown | "Something went wrong. Please try again." |

**Error Display Pattern:**
- Display error inline below the form (not alert/toast)
- Use `--error` color (#EF4444) for error text
- Clear error when user modifies any form field
- Keep form inputs populated on error (don't clear)

### Loading & Offline States
[Required for AC: 3, 6, 7]

**Auth Loading State:**
- While Firebase Auth initializes, show full-screen centered spinner with "Loading..." text
- Do not flash login page before auth state is known
- Use `onAuthStateChanged` observer, not one-time check

**Offline Behavior (MVP - Basic):**
- Service worker caches app shell (HTML, CSS, JS)
- If offline and not logged in: show "You're offline. Connect to sign in."
- If offline and logged in: show cached app shell, pages display "You're offline" banner at top
- No data fetching in this story â€” offline data sync is future work

### File Structure
```
web/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ manifest.json
â”‚   â”œâ”€â”€ icon-192.png
â”‚   â”œâ”€â”€ icon-512.png
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppShell.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AIBar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SideNav.tsx
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”‚       â”œâ”€â”€ InstallPrompt.tsx    # PWA install banner
â”‚   â”‚       â””â”€â”€ ...                  # Shadcn components
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ usePWAInstall.ts         # PWA install prompt handling
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ firebase.ts
â”‚   â”‚   â””â”€â”€ utils.ts                 # Shadcn cn() helper
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ InboxPage.tsx
â”‚   â”‚   â”œâ”€â”€ ClubPage.tsx
â”‚   â”‚   â”œâ”€â”€ BrowsePage.tsx
â”‚   â”‚   â””â”€â”€ LoginPage.tsx
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ pages/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ main.tsx
â”‚   â””â”€â”€ index.css                    # Tailwind + theme variables
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env.local                       # Firebase config (not committed)
```

### Performance Targets
[Source: front-end-spec.md Â§10.1]

| Metric | Target |
|--------|--------|
| First Contentful Paint | < 1.5s (3G) |
| Time to Interactive | < 3s (3G) |
| Largest Contentful Paint | < 2.5s (3G) |

### Accessibility Requirements
[Source: front-end-spec.md Â§7]

- WCAG 2.1 Level AA compliance
- Color contrast: 4.5:1 minimum for text
- Touch targets: 44x44px minimum
- Keyboard navigation for all features
- Semantic HTML structure

## Testing

### Test File Locations
- `web/src/__tests__/components/BottomNav.test.tsx`
- `web/src/__tests__/components/AppShell.test.tsx`
- `web/src/__tests__/components/ProtectedRoute.test.tsx`
- `web/src/__tests__/contexts/AuthContext.test.tsx`
- `web/src/__tests__/pages/LoginPage.test.tsx`
- `web/src/__tests__/hooks/usePWAInstall.test.tsx`

### Testing Framework
- Vitest (Vite-native test runner)
- React Testing Library
- @testing-library/jest-dom for matchers

### Testing Patterns
- Mock Firebase Auth for auth context tests
- Use `screen.getByRole` for accessibility-focused queries
- Test responsive behavior with `matchMedia` mocks
- Test navigation state changes

### Coverage Requirements
- All acceptance criteria must have corresponding tests
- Component tests for layout components
- Integration tests for auth flow
- Auth error handling tests (invalid credentials, network errors)
- PWA install prompt tests
- Minimum 20 test cases as listed in Task 8 (8.8-8.20 = 13 tests)

---

## Change Log
| Date | Author | Change |
|------|--------|--------|
| 2026-01-08 | Bob (SM) | UX Alignment: Added PWA install prompt timing (Task 2.6-2.9), usePWAInstall hook, InstallPrompt component, 3 additional tests (8.18-8.19). Updated file structure. |
| 2026-01-08 | Bob (SM) | Validation: Added auth error handling (Task 6.7-6.9), explicit error codes table, PWA icon generation guidance, additional test cases |
| 2026-01-08 | John (PM) | Initial draft |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Completion Notes
- All 8 tasks completed with 59 subtasks
- Created complete PWA frontend in `/web` directory:
  - React 19 + Vite + TypeScript (strict mode)
  - Tailwind CSS + Shadcn/ui design system
  - vite-plugin-pwa for service worker and manifest
  - Firebase Auth integration with emulator support
- Implemented responsive app shell:
  - AIBar placeholder (non-functional, shows toast)
  - BottomNav (mobile) with 3 tabs: Inbox, Club, Browse
  - SideNav (desktop >= 1024px) with logout
  - Offline banner when network unavailable
- Created authentication flow:
  - Login page with email/password and Google sign-in
  - ProtectedRoute wrapper for authenticated routes
  - Error handling for all Firebase Auth error codes
  - Error message clears when user types
- PWA features:
  - manifest.json with icons (192x192, 512x512)
  - Service worker with precache strategy
  - Install prompt hook (deferred until first login)
  - InstallPrompt component with dismiss option
- 48 tests passing across 7 test files

### DoD Checklist
- [x] All acceptance criteria implemented and tested
- [x] Unit tests written and passing (48 tests)
- [x] PWA installable and passes Lighthouse PWA audit
- [x] Responsive layout works on mobile and desktop
- [x] Firebase Auth integration complete
- [x] Build produces deployable output in web/dist
- [ ] No accessibility violations (axe-core) - not tested in this story

---

## QA Results

### Review Date: 2026-01-08

### Reviewed By: Quinn (Test Architect)

### Review Type: Pre-Implementation

### Code Quality Assessment
N/A - Pre-implementation review (no code to review yet)

### Requirements Traceability

| AC | Description | Tasks | Tests | Status |
|----|-------------|-------|-------|--------|
| 1 | PWA installable | T1, T2, T7 | 8.18, 8.19 | âœ“ Covered |
| 2 | Bottom nav 3 tabs | T4.3, T5 | 8.8, 8.9 | âœ“ Covered |
| 3 | Offline-read tolerant | T2.4 | 8.20 | âœ“ Covered |
| 4 | Responsive design | T1, T4.5 | 8.14 | âœ“ Covered |
| 5 | AI Bar placeholder | T4.2 | 8.10 | âœ“ Covered |
| 6 | Firebase Auth | T3, T6 | 8.11-8.13, 8.15-8.17 | âœ“ Covered |
| 7 | Auth routing | T5.6, T6 | 8.11, 8.12 | âœ“ Covered |

### Compliance Check
- Story Structure: âœ“ Complete
- Acceptance Criteria: âœ“ Clear and testable
- Tasks/Subtasks: âœ“ Comprehensive (59 subtasks)
- Dev Notes: âœ“ Excellent (design system, layouts, error codes)
- Test Cases: âœ“ All 20 cases mapped to ACs

### Findings

**Strengths:**
- Excellent design system documentation (colors, typography, layouts)
- Comprehensive auth error handling with specific Firebase error codes
- PWA install prompt timing well-specified (deferred until first login)
- Clear file structure and component organization

**Gap Resolved:**
- ~~**TEST-001** (Low): AC3 (offline-read tolerant) has no explicit test case~~
  - **Fixed**: Added test 8.20: "App shell displays offline banner when network unavailable"

### Security Review
- âœ“ Auth required for protected routes (Task 5.6)
- âœ“ Firebase config via environment variables (Task 3.6)
- âœ“ Error messages don't leak sensitive info (Task 6.7-6.9)

### Performance Considerations
- âœ“ Targets defined: FCP <1.5s, TTI <3s, LCP <2.5s
- âœ“ Service worker caching strategy documented

### Gate Status
**Gate: PASS** â†’ `docs/qa/gates/11.1-pwa-shell-navigation.yml`

### Recommended Actions
None - all gaps resolved.

### Recommended Status
âœ“ Ready for Implementation

---

### Review Date: 2026-01-08 (Post-Implementation)

### Reviewed By: Quinn (Test Architect)

### Review Type: Post-Implementation (Deep Review - Auth Files Touched)

### Code Quality Assessment

**Overall: Excellent** - The implementation is clean, well-structured, and follows React best practices.

**Highlights:**
- **AuthContext.tsx**: Well-architected context with comprehensive error handling for all Firebase auth error codes. Proper use of `onAuthStateChanged` observer pattern.
- **ProtectedRoute.tsx**: Clean, minimal implementation with proper loading state handling and location preservation for redirect.
- **LoginPage.tsx**: Excellent UX with inline error display, proper accessibility attributes (`role="alert"`, `aria-live="polite"`), and loading states.
- **AppShell.tsx**: Good offline detection with proper cleanup, accessible offline banner.
- **BottomNav.tsx**: Clean navigation with `NavLink` for active state, proper touch targets.
- **usePWAInstall.ts**: Well-implemented hook with proper event cleanup and localStorage persistence.
- **firebase.ts**: Safe emulator connection with environment-based configuration.

### Refactoring Performed

None required - code quality is excellent.

### Requirements Traceability (Given-When-Then)

| AC | Scenario | Test Coverage | Status |
|----|----------|---------------|--------|
| 1 | PWA Installable | **Given** app is loaded on mobile, **When** browser fires `beforeinstallprompt`, **Then** install prompt is deferred and shown after login | usePWAInstall.test.tsx (8.18, 8.19) | âœ“ |
| 2 | Bottom Nav | **Given** user is authenticated, **When** viewing app shell, **Then** 3 tabs (Inbox, Club, Browse) are displayed | BottomNav.test.tsx (8.8, 8.9) | âœ“ |
| 3 | Offline Tolerant | **Given** user is authenticated, **When** network goes offline, **Then** offline banner is displayed | AppShell.test.tsx (8.20) | âœ“ |
| 4 | Responsive | **Given** viewport width changes, **When** width < 1024px **Then** bottom nav shows, **When** width >= 1024px **Then** side nav shows | AppShell.test.tsx (8.14) | âœ“ |
| 5 | AI Bar | **Given** user is authenticated, **When** viewing any page, **Then** AI Bar placeholder is visible at top with disabled elements | AIBar.test.tsx (8.10) | âœ“ |
| 6 | Firebase Auth | **Given** valid credentials, **When** user submits login, **Then** user is authenticated and redirected | LoginPage.test.tsx (8.15-8.17), AuthContext.test.tsx (8.13) | âœ“ |
| 7 | Auth Routing | **Given** unauthenticated user, **When** accessing protected route, **Then** redirect to login | ProtectedRoute.test.tsx (8.11, 8.12) | âœ“ |

### Compliance Check

- Coding Standards: âœ“ TypeScript strict mode, ESLint passing, consistent patterns
- Project Structure: âœ“ Matches documented file structure in story
- Testing Strategy: âœ“ 48 tests using Vitest + React Testing Library
- All ACs Met: âœ“ All 7 acceptance criteria implemented and tested

### Improvements Checklist

- [x] All acceptance criteria implemented
- [x] All 48 tests passing
- [x] Lint clean (0 errors, 0 warnings)
- [x] Build successful (481.58 KB precached)
- [x] PWA manifest configured correctly
- [x] Service worker with precache strategy
- [x] Firebase emulator support for development
- [x] Proper error handling for all auth error codes
- [x] Accessibility attributes on interactive elements
- [ ] *(Future)* axe-core accessibility testing not performed in this story

### Security Review

- âœ“ **No hardcoded secrets** - Firebase config via `import.meta.env.VITE_*` variables
- âœ“ **Auth state management** - Uses Firebase `onAuthStateChanged` observer, not one-time check
- âœ“ **Error messages** - User-friendly messages that don't leak internal details
- âœ“ **Protected routes** - `ProtectedRoute` wrapper properly checks auth state
- âœ“ **Emulator isolation** - Only connects in DEV mode, checked via `import.meta.env.DEV`

### Performance Considerations

- âœ“ **Bundle size** - 467.63 KB gzipped to 148.72 KB (reasonable for React + Firebase)
- âœ“ **Service worker** - Precaches 16 entries (481.58 KB) for offline support
- âœ“ **Code splitting** - Could be added in future for larger app, not needed at MVP
- âœ“ **Loading states** - Proper loading spinners prevent layout shift

### NFR Validation

| NFR | Status | Notes |
|-----|--------|-------|
| Security | PASS | Auth via Firebase, no hardcoded secrets, proper error handling |
| Performance | PASS | Build output within targets, SW caching configured |
| Reliability | PASS | Offline detection, error boundaries, loading states |
| Maintainability | PASS | Clean component structure, TypeScript strict mode |

### Files Modified During Review

None - no refactoring required.

### Gate Status
**Gate: PASS** â†’ `docs/qa/gates/11.1-pwa-shell-navigation.yml`

### Recommended Status
âœ“ **Ready for Done** - All acceptance criteria met, tests passing, code quality excellent.

---

## File List

### Created Files
```
web/
â”œâ”€â”€ .env.local                              # Firebase config (not committed)
â”œâ”€â”€ .env.local.example                      # Firebase config template
â”œâ”€â”€ eslint.config.js                        # ESLint configuration
â”œâ”€â”€ index.html                              # HTML entry point with PWA meta tags
â”œâ”€â”€ package.json                            # Dependencies and scripts
â”œâ”€â”€ postcss.config.js                       # PostCSS config for Tailwind
â”œâ”€â”€ tailwind.config.js                      # Tailwind CSS configuration
â”œâ”€â”€ tsconfig.app.json                       # TypeScript app config with path aliases
â”œâ”€â”€ tsconfig.json                           # TypeScript root config
â”œâ”€â”€ tsconfig.node.json                      # TypeScript Node config
â”œâ”€â”€ vite.config.ts                          # Vite config with PWA plugin
â”œâ”€â”€ vitest.config.ts                        # Vitest test configuration
â”œâ”€â”€ components.json                         # Shadcn/ui configuration
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ apple-touch-icon.png               # PWA icon 180x180
â”‚   â”œâ”€â”€ favicon-16x16.png                   # Favicon 16x16
â”‚   â”œâ”€â”€ favicon-32x32.png                   # Favicon 32x32
â”‚   â”œâ”€â”€ favicon.ico                         # Legacy favicon
â”‚   â”œâ”€â”€ icon-192.png                        # PWA icon 192x192
â”‚   â””â”€â”€ icon-512.png                        # PWA icon 512x512
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ generate-icons.js                   # Icon generation script (sharp)
â””â”€â”€ src/
    â”œâ”€â”€ App.tsx                             # Main app with routing
    â”œâ”€â”€ main.tsx                            # Entry point
    â”œâ”€â”€ index.css                           # Tailwind + design system CSS variables
    â”œâ”€â”€ vite-env.d.ts                       # Vite type definitions
    â”œâ”€â”€ __tests__/
    â”‚   â”œâ”€â”€ components/
    â”‚   â”‚   â”œâ”€â”€ AIBar.test.tsx              # AI Bar tests (3 tests)
    â”‚   â”‚   â”œâ”€â”€ AppShell.test.tsx           # App shell tests (7 tests)
    â”‚   â”‚   â”œâ”€â”€ BottomNav.test.tsx          # Bottom nav tests (7 tests)
    â”‚   â”‚   â””â”€â”€ ProtectedRoute.test.tsx     # Protected route tests (3 tests)
    â”‚   â”œâ”€â”€ contexts/
    â”‚   â”‚   â””â”€â”€ AuthContext.test.tsx        # Auth context tests (5 tests)
    â”‚   â”œâ”€â”€ hooks/
    â”‚   â”‚   â””â”€â”€ usePWAInstall.test.tsx      # PWA install hook tests (11 tests)
    â”‚   â””â”€â”€ pages/
    â”‚       â””â”€â”€ LoginPage.test.tsx          # Login page tests (12 tests)
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ auth/
    â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx          # Auth guard component
    â”‚   â”œâ”€â”€ layout/
    â”‚   â”‚   â”œâ”€â”€ AIBar.tsx                   # AI bar placeholder
    â”‚   â”‚   â”œâ”€â”€ AppShell.tsx                # Main layout wrapper
    â”‚   â”‚   â”œâ”€â”€ BottomNav.tsx               # Mobile navigation
    â”‚   â”‚   â””â”€â”€ SideNav.tsx                 # Desktop navigation
    â”‚   â””â”€â”€ ui/
    â”‚       â”œâ”€â”€ InstallPrompt.tsx           # PWA install banner
    â”‚       â””â”€â”€ LoadingSpinner.tsx          # Loading spinner component
    â”œâ”€â”€ contexts/
    â”‚   â””â”€â”€ AuthContext.tsx                 # Firebase auth context
    â”œâ”€â”€ hooks/
    â”‚   â””â”€â”€ usePWAInstall.ts                # PWA install prompt hook
    â”œâ”€â”€ lib/
    â”‚   â”œâ”€â”€ firebase.ts                     # Firebase initialization
    â”‚   â””â”€â”€ utils.ts                        # Shadcn cn() helper
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ BrowsePage.tsx                  # Browse placeholder page
    â”‚   â”œâ”€â”€ ClubPage.tsx                    # Club placeholder page
    â”‚   â”œâ”€â”€ InboxPage.tsx                   # Inbox placeholder page
    â”‚   â””â”€â”€ LoginPage.tsx                   # Login form page
    â””â”€â”€ test/
        â””â”€â”€ setup.ts                        # Test setup (mocks)
```

### Modified Files
```
.idx/dev.nix                                # Added Node.js, web preview configuration
firebase.json                               # Updated hosting.public to web/dist, added predeploy
```

### Test Summary
- **Total Tests**: 48
- **Test Files**: 7
- **All Tests Passing**: âœ“
